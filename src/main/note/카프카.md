### ◉ 핫 파티션이란?
특정 토픽 내에 여러 개의 파티션이 있을 때 유독 다른 파티션들에 비해 훨씬 많은 양의 데이터나 트래픽(쓰기 또는 읽기 요청)을 처리하게 되는 특정 파티션을 '핫 파티션'이라고 부른다.

#### ✦ 발생 원인
- 메시지 키편중: Kafka는 메시지 키를 사용하여 어떤 파티션에 메시지를 저장할지 결정한다. 만약 특정 키를 가진 메시지가 다른 키들에 비해 압도적으로 많이 발생하면 해당 키가 할당된 파티션으로만 트래픽이 집중된다. 해당 키를 핫 키라고 부른다.
- 프로듀서 로직: 특정 프로듀서가 특정 파티션에만 집중적으로 메시지를 보내도록 잘못 구현된 경우 발생할 수 있다.
- 데이터 자체의 편향성: 처리하는 데이터 자체가 특정 속성을 가진 데이터에 집중되어 있는 경우 키 전략과 맞물려 발생할 수 있다.

#### ✦ 문제점
- 소비자 부하 불균형: 핫 파티션을 담당하는 컨슈머 인스턴스는 과도한 부하로 인해 메시지 처리가 지연(Lag 발생)되는 반면 다른 파티션을 담당하는 컨슈머는 거의 일을 하지 않게 된다.
- 브로커 부하 집중: 핫 파티션의 리더 역할을 하는 Kafka 브로커 서버에 CPU, 네트워크 대역폭, 디스크 I/O 등의 부하가 집중되어 해당 브로커의 성능 저하나 장애를 유발할 수 있다.
- 처리 지연 시간 증가: 핫 파티션의 메시지 처리가 늦어지면서 해당 파티션으로 들어오는 이벤트들의 실시간 처리가 어려워지고 전체적인 지연 시간이 길어진다.

#### ✦ 해결 방법
- 토픽의 파티션 수 증가: 문제가 되는 토픽의 파티션 수를 늘린다. 
  - 효과: 전체 키가 분산될 파티션 슬롯이 많아져 핫 키가 몰릴 확률을 줄인다. 컨슈머 병렬성을 높여 전체 처리량을 개선할 수 있다. 
  - 고려사항: 단일 키가 극도로 뜨겁다면 근본 해결책이 아니다. 파티션 수가 과도하게 증가하면 클러스터 관리 부하(파일 핸들, 메모리 등)가 증가한다.
- 메시지 키 전략 변경: 동일 애그리거트 ID 이벤트라도 서로 다른 키 값을 갖도록 키 생성 전략을 수정한다 (예: 합성 키 - 애그리거트ID-접미사, 키 솔팅)
  - 효과: 하나의 핫 애그리거트 ID에서 발생한 대량 이벤트가 여러 파티션으로 분산되어 부하를 나눈다.
  - 고려사항: 동일 애그리거트 ID 내 엄격한 이벤트 처리 순서 보장이 불가능해진다. 소비자는 이벤트를 재정렬하거나 순서에 의존하지 않는 로직으로 처리해야 한다. 순서 보장을 위해 키를 사용했던 초기 목적과 상충될 수 있다.
- 토픽 분리: 매우 활동적인 특정 애그리거트 유형/인스턴스용 토픽을 별도로 생성하여 분리한다.
  - 효과: 핫 애그리거트 ID에 대한 이벤트가 별도의 토픽으로 분리되어 핫 파티션 문제를 피할 수 있다.
  - 고려사항: 새로운 토픽을 생성하고 관리해야 하므로 운영 복잡성이 증가한다. 기존 시스템과의 통합이 필요할 수 있다.
